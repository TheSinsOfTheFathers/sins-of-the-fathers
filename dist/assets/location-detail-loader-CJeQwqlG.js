import{c as f,u as g}from"./sanityClient-DzZXYHaN.js";import{toHTML as h}from"https://esm.sh/@portabletext/to-html@2.0.13";import{a as y}from"./imageUtils-LD6ZRw5p.js";import s from"https://esm.sh/i18next@23.7.6";import"https://esm.sh/i18next-http-backend@2.4.1";import"https://esm.sh/i18next-browser-languagedetector@7.2.0";import{i as x}from"./seo-DYcZ_Lxp.js";import{g as d}from"./main-CoGTBBld.js";import"https://esm.sh/@sanity/client@6.22.0";import"https://esm.sh/@sanity/image-url@1.1.0";import"https://esm.sh/blurhash@2.0.5";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";const _=(t,e,o=1)=>{if(!t)return;const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&",r=e||t.textContent,l=r.length;let c={value:0};d.to(c,{value:1,duration:o,ease:"none",onUpdate:()=>{const p=Math.floor(c.value*l);let n="";for(let i=0;i<l;i++)i<p?n+=r[i]:n+=a[Math.floor(Math.random()*a.length)];t.textContent=n},onComplete:()=>{t.textContent=r}})},E=(t="neutral")=>{const e=document.getElementById("loc-threat");if(!e)return;const o=t.toLowerCase();let a="text-gray-500",r="fa-minus-circle";["high","critical","severe"].includes(o)?(a="text-red-500",r="fa-exclamation-triangle"):["moderate","elevated"].includes(o)?(a="text-yellow-500",r="fa-exclamation-circle"):["secure","low","safe","active"].includes(o)&&(a="text-green-500",r="fa-check-circle"),e.className=`text-xs font-mono uppercase font-bold flex items-center opacity-0 ${a}`,e.innerHTML=`<i class="fas ${r} mr-2"></i> ${t}`,["high","critical","severe"].includes(o)&&d.to(e,{opacity:.4,duration:.6,repeat:-1,yoyo:!0})},I=t=>{document.title=`${t.name} // SURVEILLANCE FEED`;const e={container:document.getElementById("location-intel"),image:document.getElementById("loc-image"),title:document.getElementById("loc-title"),faction:document.getElementById("loc-faction"),status:document.getElementById("loc-status"),coords:document.getElementById("loc-coords"),threat:document.getElementById("loc-threat"),desc:document.getElementById("loc-description"),events:document.getElementById("loc-events")};try{const n={"@context":"https://schema.org","@type":"Place",name:t.name,description:t.description?t.description.map(i=>i.children?.map(m=>m.text).join("")).join(" ").substring(0,160):"A key territory in The Sins of the Fathers universe.",url:window.location.href,image:t.mainImage?.asset?.url,geo:t.location?{"@type":"GeoCoordinates",latitude:t.location.lat,longitude:t.location.lng}:void 0,containedInPlace:t.faction?{"@type":"Place",name:t.faction.title}:void 0};x(n),console.log("> SEO Protocol: Location Schema Injected.")}catch(n){console.warn("> SEO Protocol Warning: Failed to inject schema.",n)}if(t.mainImage&&t.mainImage.asset){const n=g(t.mainImage).width(1e3).height(600).fit("crop").quality(75).url(),i=t.mainImage.asset.blurHash;y("loc-image",n,i)}const o=(n,i,m)=>{const u=document.getElementById(n);u&&(u.textContent=i||(m?s.t(m):""))};if(o("loc-title",t.name,"location_detail_page.placeholder_unknown"),o("loc-faction",t.faction?.title,"location_detail_page.tactical_unverified"),o("loc-status",t.status,"location_detail_page.tactical_operational"),t.location?o("loc-coords",`${t.location.lat.toFixed(4)}° N, ${t.location.lng.toFixed(4)}° W`):o("loc-coords","--.--, --.--"),E(t.securityLevel||s.t("location_detail_page.tactical_analyzing")),e.desc&&(e.desc.innerHTML=t.description?h(t.description):`<p class="animate-pulse">${s.t("location_detail_page.decrypting_history")}</p>`),e.events){let n=[];t.allEras&&t.allEras.forEach(i=>{if(i.events){const m=i.events.filter(u=>u.relatedLocation&&u.relatedLocation._ref===t._id);n=[...n,...m]}}),n.length>0?e.events.innerHTML=n.map(i=>`
                <li class="gsap-event-item opacity-0 border-l-2 border-white/10 pl-3 py-1 hover:border-gold transition-colors group cursor-default">
                    <span class="block text-[9px] font-mono text-gray-500">${i.date?i.date.split("-")[0]:"Unknown"}</span>
                    <span class="text-xs font-serif text-gray-300 group-hover:text-white">${i.title_en||"Redacted Event"}</span>
                </li>
            `).join(""):e.events.innerHTML=`<li class="text-xs text-gray-600 italic opacity-0 gsap-event-item">${s.t("location_detail_page.no_events_found")}</li>`}const a=d.timeline({defaults:{ease:"power2.out"}}),r=document.getElementById("feed-loader"),l=document.getElementById("location-content");r&&a.to(r,{autoAlpha:0,duration:.5}),l&&a.to(l,{autoAlpha:1,duration:.5},"-=0.3"),e.image&&a.from(e.image,{scale:1.1,filter:"grayscale(100%) blur(10px)",duration:1.5,ease:"circ.out"},"-=0.2"),e.title&&(a.add(()=>_(e.title,t.name,.8),"-=1.0"),a.from(e.title,{opacity:0,duration:.1},"-=0.8"));const c=[e.coords,e.faction,e.status,e.threat].filter(n=>n);c.length>0&&a.fromTo(c,{opacity:0,x:-10},{opacity:1,x:0,duration:.5,stagger:.1},"-=0.5"),e.desc&&a.from(e.desc,{opacity:0,y:20,duration:.8},"-=0.3");const p=document.querySelectorAll(".gsap-event-item");p.length>0&&a.to(p,{opacity:1,x:0,startAt:{x:-10},duration:.4,stagger:.05},"-=0.5")};async function D(){const t=document.getElementById("feed-loader"),o=document.getElementById("location-content")||document.querySelector("main");o&&d.set(o,{autoAlpha:0});const r=new URLSearchParams(window.location.search).get("slug");if(!r){t&&(t.innerHTML=`<p class="text-red-500 font-mono">${s.t("location_detail_loader.error_missing_slug")}</p>`),o&&d.to(o,{autoAlpha:1});return}try{console.log(`> Connecting to drone feed: ${r}`);const c=await f.fetch(`*[_type == "location" && slug.current == $slug][0]{
            _id, name, description, securityLevel, status, location, 
            mainImage { asset->{ url, "blurHash": metadata.blurHash } },
            faction->{title},
            "allEras": *[_type == "timelineEra"] {
                events[] { title_en, date, relatedLocation }
            }
        }`,{slug:r});c?I(c):(t&&(t.innerHTML=`<p class="text-red-500 font-mono">${s.t("location_detail_loader.error_not_found")}</p>`),document.getElementById("loc-title").textContent="404",o&&d.to(o,{autoAlpha:1}))}catch(l){console.error("Uplink Error:",l),t&&(t.innerHTML=`<p class="text-red-500 font-mono">${s.t("location_detail_loader.error_fetch_failed")}</p>`),o&&d.to(o,{autoAlpha:1})}}export{D as loadLocationDetails};
