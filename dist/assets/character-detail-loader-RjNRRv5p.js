const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/d3-family-tree-BwyiXZ31.js","assets/main-CoGTBBld.js","assets/main-N0Q_qPQs.css"])))=>i.map(i=>d[i]);
import{g as d,_ as w}from"./main-CoGTBBld.js";import{c as C}from"./sanityClient-DzZXYHaN.js";import{a as I}from"./imageUtils-LD6ZRw5p.js";import m from"https://esm.sh/i18next@23.7.6";import"https://esm.sh/i18next-http-backend@2.4.1";import"https://esm.sh/i18next-browser-languagedetector@7.2.0";import{g as B,i as S}from"./seo-DYcZ_Lxp.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";import"https://esm.sh/@sanity/client@6.22.0";import"https://esm.sh/@sanity/image-url@1.1.0";import"https://esm.sh/blurhash@2.0.5";const A=async t=>{const e={loader:document.getElementById("file-loader"),dossier:document.getElementById("character-dossier"),image:document.getElementById("char-image"),statusBadge:document.getElementById("char-status"),name:document.getElementById("char-name"),alias:document.getElementById("char-alias"),faction:document.getElementById("char-faction"),location:document.getElementById("char-location"),role:document.getElementById("char-role"),bio:document.getElementById("char-bio"),quote:document.getElementById("char-quote"),detailsContainer:document.querySelector(".meta-details")};if(!e.name){console.error("ERROR: Dossier layout corrupted. Missing DOM elements.");return}const l=t.image?.url||"https://placehold.co/600x800/000000/333333?text=NO+IMAGE",c=t.image?.blurHash;e.image&&(t.image?.url?I("char-image",l,c):e.image.src=l);try{const o=B({name:t.name,image:{url:l},description:t.description||"",faction:t.faction,role:t.role||t.title});S(o),console.log("> SEO Protocol: Character Schema Injected.")}catch(o){console.warn("> SEO Protocol Warning: Failed to inject schema.",o)}if(e.statusBadge){const o=t.status||"Active",n=`character_detail_page.status_${o.toLowerCase()}`;e.statusBadge.textContent=m.exists(n)?m.t(n):o,e.statusBadge.className="font-mono text-xs uppercase font-bold tracking-widest "+(o.toLowerCase()==="deceased"||o.toLowerCase()==="kia"?"text-red-600":"text-green-500")}e.name.textContent=t.name,t.alias&&(e.alias.textContent=`"${t.alias}"`),document.title=`${t.name} // ${m.t("character_detail_page.doc_title_suffix")}`,e.faction&&(e.faction.textContent=t.faction?.title||m.t("character_detail_page.unknown")),e.location&&(e.location.textContent=t.origin||(t.faction?m.t("character_detail_page.affiliated_territory"):m.t("character_detail_page.unknown"))),e.role&&(e.role.textContent=t.role||t.title||"Operative"),e.bio&&(t.description?e.bio.innerHTML=t.description.split(`
`).map(o=>`<p class="mb-4">${o}</p>`).join(""):e.bio.innerHTML=`<p class='text-red-500'>${m.t("character_detail_page.bio_error")}</p>`),e.quote&&(e.quote.textContent=t.quote?`"${t.quote}"`:"..."),d.timeline({defaults:{ease:"power3.out"}}).to(e.loader,{autoAlpha:0,duration:.5}).set(e.dossier,{autoAlpha:1}).from(e.image,{scale:1.1,filter:"grayscale(100%) blur(5px)",duration:1.5,ease:"power2.inOut"},"<").from([e.statusBadge,e.name,e.alias,e.role],{x:-30,opacity:0,duration:.8,stagger:.1},"-=1.0").from([e.faction,e.location,e.quote],{y:20,opacity:0,duration:.6,stagger:.1},"-=0.5").from(e.bio,{autoAlpha:0,y:10,duration:1},"-=0.3"),e.statusBadge&&d.to(e.statusBadge,{opacity:.5,duration:.8,repeat:-1,yoyo:!0,ease:"sine.inOut"});const r=document.getElementById("family-graph");if(r){d.set(r,{autoAlpha:0,scale:.98});const o=r.querySelector(".d3-loading"),n=r.querySelector(".d3-empty");o&&(o.style.display="flex");const p=new Map,h=(a,i=!1)=>{if(!a)return;let s=a.slug||a._id||a._ref||null,f=a.name||a.label||s,x=a.image?.url||a.image&&a.image.asset&&a.image.asset.url||null;if(typeof a=="string"&&(s=a.toLowerCase(),f=a),a.character){const g=a.character;s=g.slug||g._ref||g._id,f=g.name||f,x=g.image?.url||x}if(s)return s=String(s).replace(/\s+/g,"-").toLowerCase(),p.has(s)?i&&(p.get(s).isMain=!0):p.set(s,{id:s,label:f,image:x,isMain:i,group:i?"protagonist":"associate"}),s},u=h(t,!0),_=[];t.relationships&&Array.isArray(t.relationships)&&t.relationships.forEach(a=>{const i=h(a.character||a);u&&i&&u!==i&&_.push({source:u,target:i,label:a.status||a.type||"",strength:1})}),t.family&&Array.isArray(t.family)&&t.family.forEach(a=>{const i=h(a.character||a);u&&i&&u!==i&&_.push({source:u,target:i,label:a.relation||"Family",strength:1.5})});const E=Array.from(p.values());if(E.length>0)try{const a=await w(()=>import("./d3-family-tree-BwyiXZ31.js"),__vite__mapDeps([0,1,2])),i=r.clientWidth||300,s=r.clientHeight||400;await a.renderFamilyGraph(r,{nodes:E,links:_},{width:i,height:s,layout:"force"}),o&&(o.style.display="none"),d.to(r,{autoAlpha:1,scale:1,duration:.8,ease:"power2.out"})}catch(a){console.error("D3 Render Failed:",a),n&&(n.style.display="flex",n.innerHTML="Error rendering network.<br>System failure."),d.to(r,{autoAlpha:1})}else o&&(o.style.display="none"),n&&(n.style.display="flex",n.classList.remove("hidden")),d.to(r,{autoAlpha:1})}},U=async()=>{const e=new URLSearchParams(window.location.search).get("slug");if(!e){console.error("Access Denied: Missing slug parameter.");return}try{console.log(`> Querying database for Subject: ${e}`);const l=`*[_type == "character" && slug.current == $slug][0]{
            ...,
            "image": image.asset->{
                url,
                "blurHash": metadata.blurHash,
                "lqip": metadata.lqip
            },
            faction->{title, color}, 
            family[] {
                relation,
                character->{
                    name, 
                    "slug": slug.current,
                    "image": image.asset->{ url, "blurHash": metadata.blurHash }
                }
            },
            relationships[] {
                status,
                character->{
                    name,
                    "slug": slug.current,
                    "image": image.asset->{ url, "blurHash": metadata.blurHash }
                }
            }
        }`,c={slug:e},y=await C.fetch(l,c);y?(console.log("> Access Granted. Rendering file."),await A(y)):document.body.innerHTML=`
                <div class="flex h-screen items-center justify-center bg-black text-red-600 font-mono">
                   ERROR 404: Subject not found in archives.
                </div>`}catch(l){console.error("System Failure:",l);const c=document.querySelector("#file-loader p");c&&(c.textContent="CONNECTION FAILED",c.classList.add("text-red-500"))}};export{U as loadCharacterDetails};
