import{c as w,u as v}from"./sanityClient-DzZXYHaN.js";import{toHTML as M}from"https://esm.sh/@portabletext/to-html@2.0.13";import{a as H}from"./imageUtils-LD6ZRw5p.js";import i from"https://esm.sh/i18next@23.7.6";import"https://esm.sh/i18next-http-backend@2.4.1";import"https://esm.sh/i18next-browser-languagedetector@7.2.0";import{g as h}from"./main-CoGTBBld.js";import"https://esm.sh/@sanity/client@6.22.0";import"https://esm.sh/@sanity/image-url@1.1.0";import"https://esm.sh/blurhash@2.0.5";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";const q=(e,d,c=1)=>{if(!e)return;const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789#%&",n=d||e.textContent,p=n.length;let s={value:0};h.to(s,{value:1,duration:c,ease:"none",onUpdate:()=>{const r=Math.floor(s.value*p);let m="";for(let g=0;g<p;g++)g<r?m+=n[g]:m+=a[Math.floor(Math.random()*a.length)];e.textContent=m},onComplete:()=>{e.textContent=n}})},B=()=>{document.querySelectorAll("[data-i18n]").forEach(e=>{const d=e.getAttribute("data-i18n"),c=i.t(d);c&&(e.textContent=c)})},A=e=>{const d=(t,l,o)=>{const f=document.getElementById(t);f&&(f.textContent=l||(o?i.t(o):""))};d("lore-title",e.title);const c=`#${e._id.slice(-6).toUpperCase()}`;if(d("lore-id","#######"),d("lore-source",e.source,"lore_detail.unknown_source"),document.getElementById("lore-date")){const t=e.date?new Date(e.date).toLocaleDateString(i.language,{year:"numeric",month:"short",day:"numeric"}):i.t("lore_detail.undated");document.getElementById("lore-date").textContent=t}d("lore-author",e.author,"lore_detail.redacted");const a=document.getElementById("lore-tags");a&&e.relatedEntities?a.innerHTML=e.relatedEntities.map(t=>`
                <a href="${t._type==="character"?"character-detail":"faction-detail"}.html?slug=${t.slug}" class="gsap-tag opacity-0 text-[10px] font-mono uppercase border border-gray-700 bg-white/5 px-2 py-1 hover:border-gold hover:text-gold transition text-gray-400">
                    #${t.title||t.name}
                </a>
            `).join(""):a&&(a.innerHTML=`<span class="text-[10px] text-gray-600 font-mono">${i.t("lore_detail.no_links")}</span>`);const n=document.getElementById("lore-media-container"),p=document.getElementById("image-wrapper"),s=document.getElementById("audio-player-wrapper"),r=document.querySelector(".paper-bg");if(n&&n.classList.add("hidden"),p&&p.classList.add("hidden"),s&&s.classList.add("hidden"),r&&(r.style.display="block"),e.audioURL){if(n&&n.classList.remove("hidden"),s){s.classList.remove("hidden");const t=document.getElementById("lore-audio-source"),l=document.getElementById("audio-play-btn"),o=document.getElementById("audio-progress-bar"),f=document.getElementById("audio-current-time"),y=document.getElementById("audio-status-text"),E=document.getElementById("audio-progress-container");t.src=e.audioURL,t.load(),y.textContent=i.t("lore_detail.audio_standby");const $=()=>{t.paused?(t.play().catch(b=>console.error(b)),l.innerHTML='<i class="fas fa-pause text-xl ml-0"></i>',y.textContent=i.t("lore_detail.audio_playing"),y.classList.add("animate-pulse","text-red-500"),h.to(l,{scale:.9,duration:.1,yoyo:!0,repeat:1})):(t.pause(),l.innerHTML='<i class="fas fa-play text-xl ml-1"></i>',y.textContent=i.t("lore_detail.audio_paused"),y.classList.remove("animate-pulse","text-red-500"))},_=l.cloneNode(!0);l.parentNode.replaceChild(_,l),_.addEventListener("click",$),E&&E.addEventListener("click",b=>{const x=E.getBoundingClientRect(),L=(b.clientX-x.left)/x.width;t.duration&&(t.currentTime=L*t.duration)}),t.ontimeupdate=()=>{if(t.duration){const b=t.currentTime/t.duration*100;o.style.width=`${b}%`;const x=Math.floor(t.currentTime/60),L=Math.floor(t.currentTime%60);f.textContent=`${x.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`}},t.onended=()=>{_.innerHTML='<i class="fas fa-play text-xl ml-1"></i>',y.textContent=i.t("lore_detail.audio_ended"),y.classList.remove("animate-pulse","text-red-500"),o.style.width="0%"}}r&&!e.body&&(r.style.display="none")}else{if(e.mainImage&&e.mainImage.asset){n&&n.classList.remove("hidden"),p&&p.classList.remove("hidden");const o=v(e.mainImage).width(800).quality(80).url(),f=e.mainImage.asset.blurHash;H("lore-image",o,f)}const t=document.getElementById("lore-body"),l=e.body&&e.body.length>0;r&&(l?(r.style.display="block",t&&(t.innerHTML=M(e.body,{components:{block:{normal:({children:o})=>`<p class="mb-6 leading-relaxed opacity-90">${o}</p>`,blockquote:({children:o})=>`<blockquote class="border-l-2 border-gold pl-4 italic my-4 text-gold/80">${o}</blockquote>`,h3:({children:o})=>`<h3 class="text-gold font-mono uppercase tracking-widest text-sm mt-8 mb-2 border-b border-gold/30 pb-1">${o}</h3>`},marks:{redact:({children:o})=>`<span class="bg-black text-black px-1 select-none hover:text-gray-300 transition-colors cursor-help" title="${i.t("lore_detail.classified_tooltip")}">${o}</span>`,em:({children:o})=>`<em class="text-gray-400">${o}</em>`}}}))):r.style.display="none")}B();const m=document.getElementById("doc-loader"),g=document.getElementById("doc-content"),u=h.timeline({defaults:{ease:"power2.out"}});m&&u.to(m,{autoAlpha:0,duration:.5}),g&&(u.to(g,{autoAlpha:1,duration:.5},"-=0.3"),g.classList.remove("opacity-0"));const C=document.getElementById("lore-title"),k=document.getElementById("lore-id"),S=document.getElementById("lore-meta");C&&u.from(C,{y:-20,opacity:0,duration:.8},"-=0.2"),k&&u.add(()=>q(k,c,1),"-=0.6"),S&&u.from(S,{x:-20,opacity:0,duration:.6},"-=0.8");const T=document.querySelectorAll(".gsap-tag");if(T.length>0&&u.to(T,{opacity:1,y:0,duration:.4,stagger:.05,startAt:{y:10}},"-=0.5"),n&&!n.classList.contains("hidden"))if(e.audioURL)u.from(s,{y:-30,opacity:0,duration:.8,ease:"back.out(1.2)"},"-=0.4");else{const t=document.getElementById("lore-image");t&&u.from(t,{scale:1.05,filter:"blur(10px)",duration:1.2},"-=0.4")}r&&r.style.display!=="none"&&u.from(r,{y:50,opacity:0,duration:1,ease:"power3.out"},"-=0.6");const I=document.querySelectorAll(".bg-black.text-black");I.length>0&&h.to(I,{backgroundColor:"#222",duration:.5,repeat:1,yoyo:!0,delay:1.5,ease:"sine.inOut",onComplete:()=>h.set(I,{backgroundColor:"black"})})},K=async()=>{if(document.getElementById("evidence-container")){const a=document.getElementById("doc-content");a&&h.set(a,{autoAlpha:0})}i.isInitialized?B():i.on("initialized",()=>{B()});const c=new URLSearchParams(window.location.search).get("slug");if(c)try{const a=i.language||"en",s=`*[_type == "lore" && slug.current == $slug][0]{
            _id,
            "title": coalesce(${a==="tr"?"title_tr":"title_en"}, title_en), 
            "body": coalesce(${a==="tr"?"content_tr":"content_en"}, content_en),
            "date": date,
            source,
            author,
            "audioURL": audioFile.asset->url, 
            mainImage { asset->{ url, "blurHash": metadata.blurHash } },
            "relatedEntities": coalesce(relatedCharacters[]->{name, "title": name, "slug": slug.current, _type}, []) 
                             + coalesce(relatedFactions[]->{"title": title, "slug": slug.current, _type}, [])
        }`,r=await w.fetch(s,{slug:c});if(r)A(r);else{console.error("Doküman bulunamadı.");const m=document.getElementById("doc-loader");m&&(m.innerHTML=`<span class='text-red-500'>${i.t("lore_detail.error_not_found")}</span>`)}}catch(a){console.error("Veri çekme hatası:",a);const n=document.getElementById("doc-loader");n&&(n.innerHTML=`<span class='text-red-500'>${i.t("lore_detail.error_system")}</span>`)}};export{K as loadLoreDetails};
