import{c as w}from"./sanityClient-DzZXYHaN.js";import m from"https://esm.sh/i18next@23.7.6";import"https://esm.sh/i18next-http-backend@2.4.1";import"https://esm.sh/i18next-browser-languagedetector@7.2.0";import{i as v}from"./seo-DYcZ_Lxp.js";import{g as l}from"./main-CoGTBBld.js";import"https://esm.sh/@sanity/client@6.22.0";import"https://esm.sh/@sanity/image-url@1.1.0";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";let d=null;const f={"ballantine-empire":{border:"#c5a059",fill:"#c5a059"},"macpherson-clan":{border:"#7f1d1d",fill:"#991b1b"},default:{border:"#555555",fill:"#777777"}},C=n=>{const t=document.getElementById(n);d&&(d.off(),d.remove(),d=null),t&&(t._leaflet_id=null,l.set(t,{clearProps:"all"}))},E=n=>{if(!window.L)return null;const t=(f[n]||f.default).border;return L.divIcon({className:"tactical-pin",html:`
            <div style="position:relative; width:30px; height:30px; display:flex; justify-content:center; align-items:center;">
               <div style="position:absolute; width:100%; height:100%; border:1px solid ${t}; border-radius:50%; opacity:0.5;" class="animate-spin-slow"></div>
               <div style="width:10px; height:10px; background:${t}; border-radius:50%; box-shadow:0 0 8px ${t};"></div>
            </div>`,iconSize:[30,30],iconAnchor:[15,15],popupAnchor:[0,-15]})};async function T(n,t,o){try{const s=t.replace("/public",""),i=await fetch(s);if(!i.ok)throw new Error(`404 Not Found: ${s}`);const u=await i.json(),x=L.geoJSON(u,{style:{color:o.border,weight:1,opacity:.6,fillColor:o.fill,fillOpacity:.1,dashArray:"4 4"}}).addTo(n)}catch(s){console.warn(`[Map Layer Missing] ${t}`,s)}}async function q(){const n=document.getElementById("map"),t=document.getElementById("map-loader");n&&l.set(n,{opacity:0,scale:.98});try{const o={"@context":"https://schema.org","@type":"Map",name:"Global Surveillance Map | The Sins of the Fathers",description:"Interactive map showing all faction territories and key locations in the TSOF universe.",url:window.location.href};v(o)}catch(o){console.warn("Schema Injection Failed:",o)}if(n){if(!window.L){console.error("Leaflet Library Missing!"),t&&(t.innerHTML="<span class='text-red-500'>OFFLINE</span>");return}try{C("map");const o=L.map("map",{center:[40,-30],zoom:3,zoomControl:!1,attributionControl:!1});d=o;const i=L.control.zoom({position:"bottomright"}).addTo(o).getContainer();i&&l.set(i,{autoAlpha:0,x:50}),L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{maxZoom:18}).addTo(o),window.zoomToLocation=(e,a,c)=>{o.flyTo([e,a],c,{duration:2});const r=document.getElementById("location-name-display");r&&(r.textContent=m.t("location_loader.sector_info",{lat:e.toFixed(4),lng:a.toFixed(4)}))},window.resetMap=()=>{o.flyTo([40,-30],3,{duration:1.5});const e=document.getElementById("location-name-display");e&&(e.textContent=m.t("location_loader.global_orbit"))};const u={"ballantine-empire":["united-kingdom-border.geojson","california-border.geojson","italy-border.geojson","netherlands-border.geojson"],"macpherson-clan":["scotland-highlands.geojson"]};for(const[e,a]of Object.entries(u)){const c=f[e]||f.default;for(const r of a)await T(o,`/assets/maps/${r}`,c)}const h=await w.fetch(`*[_type == "location" && defined(location)] { 
            name, "slug": slug.current, location, faction->{slug}, summary 
        }`);console.log(`> Found ${h.length} locations.`);const y=[];h.length>0&&h.forEach(e=>{const{lat:a,lng:c}=e.location,r=e.faction?.slug?.current||"default",b=L.marker([a,c],{icon:E(r)}).addTo(o);b.bindPopup(`
                    <div class="text-left font-mono min-w-[150px]">
                        <h4 class="text-gold text-sm font-bold mb-1 border-b border-white/20 pb-1">${e.name.toUpperCase()}</h4>
                        <p class="text-[10px] text-gray-400 mb-2 line-clamp-2">${e.summary||m.t("location_loader.no_intel")}</p>
                        <a href="location-detail.html?slug=${e.slug}" class="block text-center bg-white/10 py-1 text-[9px] hover:bg-gold hover:text-black uppercase transition">
                            ${m.t("location_loader.inspect_button")}
                        </a>
                    </div>
                `,{className:"custom-popup-theme"});const g=b.getElement();g&&(y.push(g),l.set(g,{scale:0,opacity:0}))}),o.on("mousemove",e=>{const a=document.getElementById("coordinates-display");a&&(a.textContent=`${e.latlng.lat.toFixed(4)} | ${e.latlng.lng.toFixed(4)}`)});const p=l.timeline();t&&p.to(t,{autoAlpha:0,duration:.5,onComplete:()=>t.style.display="none"}),p.to(n,{opacity:1,scale:1,duration:1.2,ease:"power2.inOut"},"-=0.2"),i&&p.to(i,{autoAlpha:1,x:0,duration:.5},"-=0.5"),y.length>0&&p.to(y,{scale:1,opacity:1,duration:.6,stagger:{amount:1.5,from:"random"},ease:"back.out(2)"},"-=0.5")}catch(o){console.error("Map Critical Error:",o),n&&(n.innerHTML='<p class="text-center text-red-500 mt-10">MAP SYSTEM FAILURE</p>'),t&&(t.style.display="none"),l.to(n,{opacity:1})}}}export{q as displayLocations};
