<!DOCTYPE html>
<html lang="en"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Surveillance | The Sins of the Fathers</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 'blood': '#4a0404', 'gold': '#c5a059', 'obsidian': '#050505' },
                    fontFamily: { serif: ['Cinzel', 'serif'], sans: ['Lato', 'sans-serif'], mono: ['Courier Prime', 'monospace'] }
                }
            }
        }
    </script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&family=Courier+Prime&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <style>
        body { background-color: #050505; overflow: hidden; margin: 0; padding: 0; }
        
        /* Harita CSS Hack - Filter */
        .leaflet-layer { filter: grayscale(100%) contrast(1.1) brightness(0.6); }
        .leaflet-container { background: #080808 !important; }

        /* Overlay Patterns */
        .map-grid {
            background-image: 
                linear-gradient(rgba(197, 160, 89, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(197, 160, 89, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
        }
        .scan-line {
            height: 3px; background: rgba(197, 160, 89, 0.2);
            box-shadow: 0 0 10px rgba(197, 160, 89, 0.4);
            animation: scan 4s linear infinite;
        }
        @keyframes scan { 0% { transform: translateY(0); } 100% { transform: translateY(100vh); } }

        /* Leaflet Popup Customization */
        .leaflet-popup-content-wrapper {
            background: rgba(5,5,5,0.95);
            border: 1px solid #c5a059;
            color: #ccc; border-radius: 0;
        }
        .leaflet-popup-tip { background: #c5a059; }
        .leaflet-popup-content { min-width: 190px !important; }
        .leaflet-popup-close-button { 
            pointer-events: auto !important;
            cursor: pointer !important;
            z-index: 10 !important;
        }
        .leaflet-popup-close-button:hover { color: #fff !important; }
        .custom-tactical-icon .animate-spin-slow { animation: spin 10s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="../assets/js/main.js" type="module" defer></script>
</head>

<body class="h-screen w-screen bg-obsidian text-gray-300 relative">

    <!-- HEADER (Z-Index 50 -> En Üstte) -->
    <header class="absolute top-0 w-full z-50 bg-black/80 backdrop-blur border-b border-white/10 h-16 pointer-events-auto">
        <nav class="container mx-auto px-4 h-full flex justify-between items-center">
            <a href="../index.html" class="text-xl font-serif text-gold uppercase tracking-widest hover:text-white transition-colors">
                TSOF <span class="hidden md:inline text-xs text-gray-600 ml-2">// GLOBAL MAP</span>
            </a>
            
            <!-- Desktop Nav -->
            <div class="hidden md:flex items-center space-x-6">
                <a href="factions.html" class="text-xs text-gray-500 hover:text-gold uppercase tracking-widest flex items-center border-r border-white/10 pr-4">
                    <i class="fas fa-times mr-2"></i> Close Map
                </a>
                <div class="flex gap-4" id="auth-controls">
                    <a href="login.html" class="text-[10px] text-gold hover:text-white uppercase border border-gold/30 px-3 py-1 guest-only">Login</a>
                </div>
            </div>

            <!-- Mobile Hamburger -->
            <div class="md:hidden">
                <button id="hamburger-button" class="text-gold"><i class="fas fa-bars"></i></button>
            </div>
        </nav>
    </header>

    <!-- MOBILE MENU OVERLAY (Z-Index 60) -->
    <div id="mobile-menu" class="hidden fixed inset-0 z-[60] bg-black flex-col items-center justify-center space-y-6">
        <a href="../index.html" class="text-xl text-white uppercase">Home</a>
        <a href="characters.html" class="text-xl text-white uppercase">Characters</a>
        <a href="factions.html" class="text-xl text-white uppercase">Factions</a>
        <a href="login.html" class="text-sm text-gold border border-gold px-4 py-2">Access Terminal</a>
    </div>

    <!-- HUD UI (Z-Index 20 - Tıklama Geçirgenliği İçin 'pointer-events-none') -->
    <div class="absolute inset-0 z-20 pointer-events-none pt-16 flex flex-col justify-between">
        
        <!-- Scanline (Efekt) -->
        <div class="absolute top-0 left-0 w-full scan-line opacity-50"></div>

        <!-- Left Panel Info -->
        <div class="p-4 md:p-8 pointer-events-auto w-fit">
            <div class="bg-black/80 border-l-2 border-gold p-3 max-w-[200px] backdrop-blur">
                <h2 class="text-[10px] text-gold font-mono uppercase mb-1">Sector Data</h2>
                <div class="h-px bg-gray-800 w-full mb-2"></div>
                <p id="coordinates-display" class="font-mono text-[10px] text-gray-400">Scanning...</p>
            </div>
        </div>

        <!-- Right Controls (Butonlar) -->
        <div class="absolute top-24 right-4 flex flex-col gap-2 pointer-events-auto">
            <h3 class="text-[9px] text-gray-600 font-mono uppercase text-right">Deployments</h3>
            <!-- onclick fonksiyonları location-loader.js tarafından window'a atanıyor -->
            <button onclick="window.zoomToLocation && window.zoomToLocation(56.49, -4.20, 7)" 
                    class="bg-black/70 border border-gray-800 hover:border-gold text-[10px] text-gray-400 hover:text-gold px-3 py-2 uppercase backdrop-blur text-right transition-colors">
                <i class="fas fa-shield-alt mr-1"></i> Scotland
            </button>
            <button onclick="window.zoomToLocation && window.zoomToLocation(34.05, -118.24, 10)" 
                    class="bg-black/70 border border-gray-800 hover:border-gold text-[10px] text-gray-400 hover:text-gold px-3 py-2 uppercase backdrop-blur text-right transition-colors">
                <i class="fas fa-building mr-1"></i> Los Angeles
            </button>
            <button onclick="window.resetMap && window.resetMap()" 
                    class="mt-4 bg-gold/10 border border-gold/30 hover:bg-gold text-[9px] text-gold hover:text-black px-3 py-1 uppercase backdrop-blur transition-colors">
                Global Reset
            </button>
        </div>

        <!-- Bottom Text -->
        <div class="w-full text-center pb-4">
            <p id="location-name-display" class="font-mono text-[10px] text-gray-600 uppercase tracking-[0.2em]">Waiting for signal...</p>
        </div>
    </div>

    <!-- HARİTA KATMANI (Z-Index 0 ve 1) -->
    <!-- Tıklamayı Engelleyen her şeyi bu wrapper'ın üzerine çıkarma! -->
    <div class="absolute inset-0 pt-16 z-0">
        <!-- Map Div (Tıklanabilir olmalı, bu yüzden Z-index veya pointer-events sorunu olmamalı) -->
        <div id="map" class="w-full h-full bg-neutral-900"></div>
        
        <!-- Grid Overlay (Haritanın üstünde ama tıklamayı engellemez) -->
        <div class="absolute inset-0 map-grid pointer-events-none opacity-30 z-[1]"></div>
    </div>

    <!-- Loader (En Üst) -->
    <div id="map-loader" class="fixed inset-0 z-[100] bg-obsidian flex flex-col items-center justify-center transition-opacity duration-1000">
        <i class="fas fa-circle-notch fa-spin text-gold text-2xl mb-2"></i>
        <p class="font-mono text-[10px] text-gold uppercase tracking-widest">Satellite Link Initializing...</p>
    </div>

</body>
</html>